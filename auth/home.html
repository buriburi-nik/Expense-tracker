<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Expense Tracker</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        /*=============== VARIABLES CSS ===============*/
        :root {
            --primary-color: hsl(208, 92%, 54%);
            --title-color: hsl(220, 68%, 4%);
            --text-color: hsl(217, 7%, 42%);
            --background-color: hsl(0, 0%, 100%);
            --input-bg: hsl(220, 50%, 97%);
            /* --button-color: hsl(208, 92%, 54%); */
            --button-color: black;
            --button-hover: hsl(180, 1%, 23%);
            --body-font: "Montserrat", sans-serif;

            --big-font-size: 3rem;
            --normal-font-size: .938rem;
            --small-font-size: .9rem;
            --tiny-font-size: .688rem;

            --font-regular: 400;
            --font-medium: 500;
            --font-semi-bold: 600;

            --z-tooltip: 10;
            --z-fixed: 100;
        }

        /*=============== BASE STYLES ===============*/
        * {
            box-sizing: border-box;
            padding: 0;
            margin: 0;
        }

        body {
            display: flex;
            flex-direction: column;
            height: auto;
            /* background-color: #D9D9F4; */
            background-color: var(--background-color);
            font-family: var(--body-font);
            align-items: center;
            padding: 0 155px;
            overflow-x: hidden;

        }

        header {
            text-align: center;
            margin-bottom: 2rem;
            display: flex;
            justify-content: space-evenly;
            gap: 130px;
            align-items: center;
            width: 100vw;
            background-color: #EEEEEE;
        }

        header h1 {
            font-size: 2.5rem;
            color: var(--title-color);
            margin-bottom: 0.5rem;
        }

        header p {
            font-size: 1.1rem;
            color: var(--text-color);
        }

        section {
            width: 80%;
            max-width: 800px;
            margin-bottom: 3rem;
            background-color: var(--background-color);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border: 2px solid #fff;
        }

        img {
            border-radius: 10px;
        }

        section h2 {
            font-size: 2rem;
            color: var(--title-color);
            margin-bottom: 1rem;
        }

        ul {
            list-style-type: none;
            padding: 0;
            margin: 0;
        }

        form {
            display: flex;
            flex-direction: column;
        }

        form label {
            font-size: 1rem;
            color: var(--text-color);
            margin-bottom: 0.5rem;
        }

        form input,
        form select,
        form button {
            width: 100%;
            padding: 15px;
            margin-bottom: 1rem;
            font-size: 1rem;
            border-radius: 8px;
            border: 1px solid #ddd;
            background-color: var(--input-bg);
            border-radius: 4rem;
        }

        form input:focus,
        form select:focus {
            border-color: var(--button-color);
            outline: none;
        }

        form button {
            background-color: var(--button-color);
            color: white;
            font-weight: var(--font-semi-bold);
            border: none;
            cursor: pointer;
            transition: background-color 0.4s, box-shadow 0.4s;
            border-radius: 4rem;
        }

        form button:hover {
            background-color: var(--button-hover);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        footer {
            text-align: center;
            font-size: 0.9rem;
            color: var(--text-color);
            margin-top: 2rem;
            padding: 20px;
        }

        /* Mobile Responsive */
        @media screen and (max-width: 768px) {
            body {
                justify-content: center;
                padding: 0 10px;
            }

            section {
                width: 100%;
                margin-bottom: 0;
            }

            .welcome-message {
                display: none;
            }

            header {
                flex-direction: column;
                align-items: center;
                gap: 2px;
            }

            header h1 {
                font-size: 2rem;
            }

            header p {
                font-size: 1rem;
            }

            form input,
            form select,
            form button {
                font-size: 1rem;
            }

            .bingo {
                flex-direction: column;
                width: 90%;
            }

            main {
                display: flex;
                flex-direction: column;
                align-items: center;
                padding: 20px;
            }

            .a , .b , .c{
                margin-bottom: 2rem;
            }
        }


        .welcome-message {
            font-size: 18px;
            width: 40px;
        }

        main {
            display: flex;
            flex-direction: column;
            align-items: center;
            /* padding: 20px 120px; */
            width: 100%;
        }

        .secondary {
            width: 100%;

        }

        a {
            text-decoration: none;
            color: var(--button-color);
        }

        a:hover {
            color: var(--button-hover);
        }


        button {
            font-weight: var(--font-semi-bold);
            border: none;
            cursor: pointer;
            background-color: transparent;
            transition: background-color 0.4s, box-shadow 0.4s;
            padding: 10px 20px;
            border-radius: 8px;
            margin-top: 10px;

        }

        button:hover {
            background-color: transparent;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);

        }

        /* Bingo Table */
        .bingo {
            display: flex;
            width: 100%;
            justify-content: space-between;
            gap: 2rem;

        }

        .b1 {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            font-size: 20px;
            color: white;
            transition: background-color 0.4s, box-shadow 0.4s;
            margin-top: 10px;
            text-align: center;
            background-color: #FFB400;
        }
    </style>
</head>

<body>
    <header>

        <div class="welcome-message" id="welcomeMessage">Welcome,Guest</div>
        <div style="padding:1rem;">
            <h1>Expense Tracker</h1>
            <p>Track expenses, set budgets, and monitor trends easily.</p>
        </div>
        <button class="new" style="font-size: medium;" onclick="window.location.href='login.html'">Logout</button>

        <script>
            const name = localStorage.getItem('signupName') || 'Guest';
            
            document.getElementById('welcomeMessage').textContent = `Welcome, ${name}!`;
        
        </script>

    </header>

    <main>
        <div class="bingo a">

            <!-- Budget and Alerts -->
            <section class="budget" style="background-color: #C7C2EF;">
                <h2>Set Budget </h2>
                <form id="budget-form">
                    <label for="budget-amount">Budget Limit (₹):</label>
                    <input type="number" id="budget-amount" placeholder="Enter your budget limit" required>
                    <button type="submit">Set Budget</button>
                </form>
                <p id="budget-status">No budget set yet.</p>

                <!-- display budget -->
                <span id="budget1" class="b1">N/A</span>
                <script>
                    // display budget-amount in span element of class "b1"
                </script>
            </section>

            <!-- Expense Form -->
            <section class="tracker" style="background-color: #FAE5DC;">
                <h2>Add Expense</h2>
                <form id="expense-form">
                    <label for="expense-name">Expense Name:</label>
                    <input type="text" id="expense-name" placeholder="Enter expense name" required>

                    <label for="expense-amount">Amount (₹):</label>
                    <input type="number" id="expense-amount" placeholder="Enter amount" required>

                    <label for="expense-category">Category:</label>
                    <select id="expense-category">
                        <option value="Materials">Food</option>
                        <option value="Labour">Transport</option>
                        <option value="Overhead">Entertainment</option>
                        <option value="Other">Other</option>
                    </select>

                    <button type="submit">Add Expense</button>

                </form>
            </section>


            <!-- Expense Trends -->
            <section class="trends" style="background-color: #C0EFE9;">
                <h2>Expense vs Budget </h2>
                <p>Total Expense: <span id="total-expense">₹0</span></p>
                <p style="margin-bottom: 0.2rem;">Remaining Budget: <span id="remaining-budget">N/A</span></p>
                <canvas id="trends-chart" style="display: none;"></canvas>
                <canvas id="budget-pie-chart"></canvas>
            </section>
        </div>

        <div class="bingo b">
            <!-- Expense Summary -->
            <section class="summary" style="background-color: aliceblue">
                <h2>Expense Summary</h2>
                <div class="vis">
                    <label for="chart-type">Select Chart Type:</label>
                    <select id="chart-type">
                        <option value="pie">Pie Chart</option>
                        <option value="bar">Bar Chart</option>
                        <option value="line">Line Chart</option>
                    </select>
                </div>
                <br>
                <canvas id="expense-chart" style="max-height: 400px;"></canvas>
            </section>
            <!-- AI Financial Advisor Section -->
            <section class="ai-advisor" style="background-color: #C7C2EF;">
                <h2>AI Financial Advisor</h2>
                <p id="financial-advice">Loading personalized advice...</p>
                <br>
                <h2>AI Chatbot</h2>
                <div id="chat-interface">
                    <div id="chat-log"
                        style="background: #f9f9f9; padding: 10px; border-radius: 10px; height: 200px; overflow-y: auto; margin-bottom: 10px;">
                        <!-- Chat messages will appear here -->
                    </div>
                    <form id="chat-form" style="display: flex; gap: 10px; flex-direction: column;">
                        <input type="text" id="chat-input" placeholder="Ask me something..."
                            style="flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 5px;" />
                        <button type="submit">Send</button>
                    </form>
                </div>

            </section>
        </div>


        <div class="bingo c">
            <!-- Taxes Calculator Section -->
            <section class="tax-calculator" style="margin-bottom:0; background-color: #FAE5DC;">
                <h2>Taxes Calculator</h2>
                <form id="tax-form">
                    <label for="income">Annual Income (₹):</label>
                    <input type="number" id="income" placeholder="Enter annual income" required>
            
                    <label for="tax-deductions">Deductions (₹) (Optional):</label>
                    <input type="number" id="tax-deductions" placeholder="Enter deductions (optional)">
            
                    <button type="submit">Calculate Taxes</button>
                </form>
                <div id="tax-results">
                    <p id="estimated-taxes">Estimated Taxes: ₹0</p>
                    <p id="tax-summary">Tax calculation is illustrative. Consult official tax resources for accurate calculations.
                    </p>
                </div>
            </section>

            <img src="../img/tax.jpg" alt="" style="width: 100%; height: 400px;">


            <section class="tour-guide" style="margin-bottom:0 ; background-color: #C0EFE9;">
                <h2>Tax Planning Guide</h2>
                <p>Estimate your taxes and plan accordingly. This guide provides tips on how to reduce your tax
                    liability:
                </p>
                <ul>
                    <li><strong>Tax Deductions:</strong> Contribute to retirement funds to save on taxes.</li>
                    <li><strong>Tax Credits:</strong> Explore available credits for education, homeownership, and more.
                    </li>
                    <li><strong>Tax Planning:</strong> Plan ahead to avoid surprises during tax season.</li>
                </ul>
            </section>
        </div>

    </main>

    <footer>
        <p>© 2025 Advanced Expense Tracker. All Rights Reserved.</p>
    </footer>

    <script>const expenseForm = document.getElementById('expense-form');
        const budgetForm = document.getElementById('budget-form');
        const totalExpenseDisplay = document.getElementById('total-expense');
        const remainingBudgetDisplay = document.getElementById('remaining-budget');
        const budgetStatus = document.getElementById('budget-status');
        const expenseChartCanvas = document.getElementById('expense-chart');
        const trendsChartCanvas = document.getElementById('trends-chart');
        const chartTypeSelector = document.getElementById('chart-type');

        // 

        // Data Storage
        let totalExpense = 0;
        let budget = null;
        let expenseData = { Materials: 0, Labour: 0, Overhead: 0, Other: 0 };
        let expenseTrends = [];

        // Budget Pie Chart Initialization
        const budgetPieChartCanvas = document.getElementById('budget-pie-chart');
        let budgetPieChart = new Chart(budgetPieChartCanvas, {
            type: 'pie',

            data: {
                labels: ['Total Expense', 'Remaining Budget'],
                datasets: [
                    {
                        data: [0, 0],  // Initial data (Total Expense = 0, Remaining Budget = 0)
                        backgroundColor: ['#B1C29E', '#FFF2AF'],  // Red for Total Expense, Green for Remaining Budget
                    },
                ],
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { position: 'bottom' },
                },
            },
        });

        // Expense Chart Initialization
        let expenseChart = new Chart(expenseChartCanvas, {
            type: 'pie',
            data: {
                labels: ['Food', 'Transport', 'Entertainment', 'Other'],
                datasets: [
                    {
                        data: [0, 0, 0, 0],
                        backgroundColor: ['#F2C6D9', '#FFF7F0', '#B5E0C3', '#F9E0C2'],
                    },
                ],
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { position: 'bottom' },
                },
            },
        });

        // Trends Chart Initialization
        const trendsChart = new Chart(trendsChartCanvas, {
            type: 'line',
            data: {
                labels: [],
                datasets: [
                    {
                        label: 'Expense Trends',
                        data: [],
                        borderColor: '#4caf50',
                        fill: false,
                    },
                ],
            },
            options: {
                responsive: true,
                scales: {
                    x: { title: { display: true, text: 'Date' } },
                    y: { title: { display: true, text: 'Amount (₹)' } },
                },
            },
        });

        // Function to update all charts, including the Budget Pie Chart
        function updateCharts() {
            // Update Expense Chart (Pie)
            expenseChart.data.labels = Object.keys(expenseData);
            expenseChart.data.datasets[0].data = Object.values(expenseData);
            expenseChart.update();

            // Update Trends Chart (Line)
            trendsChart.data.labels = expenseTrends.map((entry) => entry.date);
            trendsChart.data.datasets[0].data = expenseTrends.map((entry) => entry.amount);
            trendsChart.update();

            // Update Budget Pie Chart
            if (budget !== null) {
                const remainingBudget = budget - totalExpense;
                budgetPieChart.data.datasets[0].data = [totalExpense, remainingBudget];
                budgetPieChart.update();
            }
        }

        // Change the chart type dynamically
        chartTypeSelector.addEventListener('change', () => {
            const newType = chartTypeSelector.value;

            expenseChart.destroy();
            expenseChart = new Chart(expenseChartCanvas, {
                type: newType,
                data: {
                    labels: Object.keys(expenseData),
                    datasets: [
                        {
                            data: Object.values(expenseData),
                            backgroundColor: ['#4caf50', '#ff9800', '#f44336', '#2196f3'],
                        },
                    ],
                },
                options: {
                    responsive: true,
                    plugins: { legend: { position: 'bottom' } },
                    scales:
                        newType === 'pie'
                            ? undefined
                            : {
                                x: { title: { display: true, text: 'Categories' } },
                                y: { beginAtZero: true, title: { display: true, text: 'Amount (₹)' } },
                            },
                },
            });
        });

        // Expense Form Submission Handler
        expenseForm.addEventListener('submit', (event) => {
            event.preventDefault();

            const expenseName = document.getElementById('expense-name').value.trim();
            const expenseAmount = parseFloat(document.getElementById('expense-amount').value);
            const expenseCategory = document.getElementById('expense-category').value;

            if (!expenseName || isNaN(expenseAmount)) {
                alert('Please fill all fields correctly!');
                return;
            }

            // Prevent exceeding budget
            if (budget && totalExpense + expenseAmount > budget) {
                alert('This expense exceeds your budget!');
                return;
            }

            // Update Data
            totalExpense += expenseAmount;
            expenseData[expenseCategory] += expenseAmount;

            // Track Expense Trend
            const currentDate = new Date().toLocaleDateString();
            expenseTrends.push({ date: currentDate, amount: totalExpense });

            // Update UI and Alerts
            totalExpenseDisplay.textContent = `₹${totalExpense}`;
            if (budget) {
                const remainingBudget = budget - totalExpense;
                remainingBudgetDisplay.textContent = `₹${remainingBudget}`;
                budgetStatus.textContent =
                    remainingBudget <= 0
                        ? 'Budget exceeded!'
                        : remainingBudget <= budget * 0.1
                            ? 'Warning: Approaching budget limit!'
                            : 'Budget is under control.';
            }

            updateCharts();  // Update all charts after expense is added
            expenseForm.reset();
        });

        // Budget Form Submission Handler
        budgetForm.addEventListener('submit', (event) => {
            event.preventDefault();

            budget = parseFloat(document.getElementById('budget-amount').value);
            if (isNaN(budget) || budget <= 0) {
                alert('Please enter a valid budget.');
                return;
            }

            remainingBudgetDisplay.textContent = `₹${budget - totalExpense}`;
            budgetStatus.textContent = 'Budget set successfully!';

            //display budget - amount in span element of class "b1"
            document.getElementById('budget1').textContent = `₹${budget}`;

            updateCharts();  // Update all charts when the budget is set
            budgetForm.reset();
        });

        function generateFinancialAdvice() {
            const totalExpenses = totalExpense;
            const budgetStatusMessage = budgetStatus.textContent;

            let advice = "Your financial health looks great! Keep up the good work.";

            if (totalExpenses > budget) {
                advice = "You’ve exceeded your budget! Consider cutting back on non-essential expenses.";
            } else if (totalExpenses > budget * 0.8) {
                advice = "You’re approaching your budget limit! Monitor your spending closely.";
            } else if (expenseData.Labour > expenseData.Materials) {
                advice = "You’re spending more on Labour than Materials. Consider evaluating your staffing costs.";
            } else if (totalExpenses < budget * 0.5) {
                advice = "You’re under budget! Consider setting aside savings or investing the surplus.";
            }

            // Update the financial advice section
            document.getElementById('financial-advice').textContent = advice;
        }





        const chatForm = document.getElementById('chat-form');
        const chatInput = document.getElementById('chat-input');
        const chatLog = document.getElementById('chat-log');

        // Handle chatbot form submission
        chatForm.addEventListener('submit', (event) => {
            event.preventDefault();
            const userMessage = chatInput.value.trim();

            if (!userMessage) {
                alert('Please enter a message!');
                return;
            }

            // Display the user's message in the chat log
            appendMessage('You', userMessage);

            // Generate AI response
            setTimeout(() => {
                const aiResponse = generateChatbotResponse(userMessage);
                appendMessage('Gemini AI', aiResponse);
            }, 1000);

            // Clear the input field
            chatInput.value = '';
        });

        // Function to add messages to the chat log
        function appendMessage(sender, message) {
            const messageElement = document.createElement('div');
            messageElement.style.marginBottom = '10px';
            messageElement.innerHTML = `<strong>${sender}:</strong> ${message}`;
            chatLog.appendChild(messageElement);

            // Auto-scroll to the bottom
            chatLog.scrollTop = chatLog.scrollHeight;
        }

        // Function to generate chatbot responses
       function generateChatbotResponse(message) {
            const lowerMessage = message.toLowerCase();

            if (lowerMessage.includes('budget')) {
                return "Budgeting is key to financial control. It's not about restricting yourself, but about consciously allocating your resources.\nTips:\n* Track your spending meticulously for a month.\n* Automate savings by setting up recurring transfers.\n* Review your budget regularly and adjust it as needed.";
            } else if (lowerMessage.includes('saving')) {
                return "Saving is the cornerstone of financial security.\nTips:\n* Set clear, achievable savings goals with timelines.\n* Automate your savings by setting up automatic transfers.\n* Explore high-yield savings accounts or money market accounts.";
            } else if (lowerMessage.includes('investment')) {
                return "Investing is essential for long-term wealth growth.\nTips:\n* Understand your risk tolerance and time horizon.\n* Diversify your investments across different asset classes.\n* Consider investing in low-cost index funds or ETFs.";
            } else if (lowerMessage.includes('debt')) {
                return "Managing debt is crucial for financial well-being.\nTips:\n* List all your debts, including interest rates and balances.\n* Prioritize paying off high-interest debt first.\n* Create a debt repayment plan and stick to it.";
            } else if (lowerMessage.includes('credit')) {
                return "A good credit score is essential for accessing affordable credit.\nTips:\n* Pay your bills on time, every time.\n* Keep your credit utilization low (below 30% is ideal).\n* Check your credit report regularly for errors.";
            } else if (lowerMessage.includes('retirement')) {
                return "Retirement planning is a long-term endeavor that requires careful consideration.\nTips:\n* Start saving for retirement as early as possible.\n* Contribute to tax-advantaged retirement accounts.\n* Diversify your retirement investments.";
            } else if (lowerMessage.includes('emergency fund')) {
                return "An emergency fund is your financial safety net.\nTips:\n* Aim to save 3-6 months of essential living expenses.\n* Keep your emergency fund in a readily accessible, liquid account.\n* Replenish your emergency fund as soon as possible after you use it.";
            } else if (lowerMessage.includes('tax')) {
                return "Understanding taxes can save you money.\nTips:\n* Keep accurate records of your income and expenses.\n* Explore tax-saving strategies, such as contributing to retirement accounts.\n* File your tax returns on time to avoid penalties.";
            } else if (lowerMessage.includes('finance') || lowerMessage.includes('money')) {
                return "Personal finance is about managing your money wisely.\nTips:\n* Set SMART financial goals (Specific, Measurable, Achievable, Relevant, Time-bound).\n* Develop a comprehensive financial plan.\n* Educate yourself about personal finance through books, articles, and online resources.";
            } else {
                return "I'm here to help with your personal finance questions! Ask me about budgeting, saving, investing, debt, credit, retirement, taxes, or any other financial topic.  The more specific your questions, the more detailed and informative my responses can be.";
            }
        }
                   document.getElementById('tax-form').addEventListener('submit', function (event) {
                    event.preventDefault();

                    const income = parseFloat(document.getElementById('income').value);
                    let deductions = parseFloat(document.getElementById('tax-deductions').value);

                    if (isNaN(income) || income < 0) {
                        alert("Please enter a valid number for income.");
                        return;
                    }

                    // Handle optional deductions: If no deduction is entered, treat it as 0
                    if (isNaN(deductions) || deductions < 0) {
                        deductions = 0;
                    }

                    const taxableIncome = Math.max(0, income - deductions);

                    let tax = 0;
                    // Simplified tax calculation (Illustrative - Consult official resources)
                    if (taxableIncome <= 250000) {
                        tax = 0;
                    } else if (taxableIncome <= 500000) {
                        tax = (taxableIncome - 250000) * 0.05;
                    } else if (taxableIncome <= 1000000) {
                        tax = 12500 + (taxableIncome - 500000) * 0.20;
                    } else {
                        tax = 112500 + (taxableIncome - 1000000) * 0.30;
                    }


                    document.getElementById('estimated-taxes').textContent = `Estimated Taxes: ₹${tax.toFixed(2)}`;

                });
            
    // </script>

</body>

</html>